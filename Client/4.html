<!DOCTYPE html>

<html>

<head>
    
    <!-- заголовок страницы -->
    <title> Pilot Project </title>
    
    <script>
        
    if (window.step !== 4) {
        window.location.replace("/");
    } else {

        /*globals socket*/
        socket.emit('getIncome');
        socket.on('getIncome', function (message) {

            'use strict';

            var temp = "", count;

            for (count = 0; count < message.result.length; count += 1) {

                if (count === 0) {
                    temp = temp + "<option value='" + message.result[count].id + "'>" + "< " + message.result[count].max + "<\/option>";
                }
                if (count === message.result.length - 1) {
                    temp = temp + "<option value='" + message.result[count].id + "'>" + "> " + message.result[count].min + "<\/option>";
                }

                if (count !== 0 && count !== message.result.length - 1) {
                    temp = temp + "<option value='" + message.result[count].id + "'>" + message.result[count].min + "-" + message.result[count].max + "<\/option>";
                }

            }

            /*globals $*/
            $('#selector3').empty();
            $('#selector3').append(temp);
            
        });





        $('#button-p4').click(function () {

            'use strict';

            $('.error').remove();
            var data = {
                income: $('select option:selected').val()
            };

            if (data.income) {
                socket.emit('setIncome', {
                    'params': {
                        income: data.income
                    }
                });
                
                // запрос проверки от сервера
                socket.on('checkIncome', function (message) {

                    if (message.result === true) {
                        $('body').empty();
                        $.ajax({
                            url: '5.html',
                            type: "GET",
                            dataType: 'text',
                            success: function (html) {
                                window.step = 5;
                                $('body').css("margin-left", "100%");
                                $('body').html(html);
                                $('body').animate({
                                    marginLeft: "0%"
                                }, 200);
                            }
                        });

                    } else {

                        $('body').empty();
                        $.ajax({
                            url: 'errors.html',
                            type: "GET",
                            dataType: 'text',
                            success: function (html) {
                                window.step = 'errors';
                                $('body').css("margin-left", "100%");
                                $('body').html(html);
                                $('body').animate({
                                    marginLeft: "0%"
                                }, 200);
                            }
                        });

                    }
                });

            } else {
                $('.page').append("<div class='error'>Choose Your income!<\/div>");
            }
        });


        $('#button-back-p4').click(function () {

            'use strict';

            $('body').empty();
            $.ajax({
                url: '3.html',
                type: "GET",
                dataType: 'text',
                success: function (html) {
                    window.step = 3;
                    $('body').css("margin-left", "-100%");
                    $('body').html(html);
                    $('body').animate({
                        marginLeft: "0%"
                    }, 200);
                }
            });
        });
    }

    </script>

</head>

<!-- структура основной страницы -->
<body>
    <div class="page">
        
        <div class="text">Select your income</div>
        
        <select id="selector3">

		</select>
        
        <br>
        
        <button class="button-back" id="button-back-p4">Back</button>
        
        <button class="button" id="button-p4">Next!</button><br>
        
    </div>

</body>

</html>
